<!DOCTYPE html>
<html lang="en">
<head>
    <title>TEST</title>
    <meta charset="utf-8">
    
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="project.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="image/favicon.ico" type="image/x-icon"> 
    
   
    <script>
    
    //set attribute for ele
    function setAtr(ele, attr){
        for(let i in attr){
            ele.setAttribute(i, attr[i]);
        }
    }
    
    //send request to server, get data in JSON format, display it in class productTable 
    function ajaxProcess(ajax) {
        ajax.onreadystatechange = function ( ){
        if(this.readyState == 4 && this.status == 200){
            var data = JSON.parse(this.responseText);
            console.log(data);

            let html = "";

            if(data.length == 0){
                html = "Find 0 result";
                return;
            }

            for (let i = 0;i< data.length;i++){
                //Extract data from JSON
                let PID = data[i].PID;
                let PName = data[i].PName;
                let Price = data[i].Price;
                let Publisher = data[i].Publisher;
                let ReleaseDate = data[i].ReleaseDate;
                let Quantity = data[i].Quantity;
                
                let tbody = document.getElementById("productControl");
                
                let tr = document.createElement("tr");
                tbody.appendChild(tr);
                
                //fill data in each row
                let td1 = document.createElement("td");
                td1.innerHTML = PID;
                tr.appendChild(td1);
                
                let td2 = document.createElement("td");
                td2.innerHTML = PName;
                tr.appendChild(td2);
                
                let td3 = document.createElement("td");
                td3.innerHTML = Price;
                tr.appendChild(td3);
                
                let td4 = document.createElement("td");
                td4.innerHTML = Publisher;
                tr.appendChild(td4);
                
                let td5 = document.createElement("td");
                td5.innerHTML = ReleaseDate;
                tr.appendChild(td5);
                
                let td6 = document.createElement("td");
                td6.innerHTML = Quantity;
                tr.appendChild(td6);
                
                let td7 = document.createElement("td");
                let updateBtn = document.createElement("button");
                setAtr(updateBtn,{"type":"button","class":"btn btn-primary","data-toggle":"modal", "data-target":"#m"+PID})
                updateBtn.innerHTML = "Update";
                td7.appendChild(updateBtn);
                tr.appendChild(td7);
                
                let td8 = document.createElement("td");
                let deleBtn = document.createElement("button");
                setAtr(deleBtn,{"type":"button","class":"btn btn-danger"})
                deleBtn.innerHTML = "Delete";
                td8.appendChild(deleBtn);
                tr.appendChild(td8);
                
                
            html += 
            "<tr>"+
                "<td>"+PID+"</td>"+
                "<td>"+PName+"</td>"+
                "<td>"+Price+"</td>"+
                "<td>"+ReleaseDate+"</td>"+
                "<td>"+Publisher+"</td>"+
                "<td>"+Quantity+"</td>"+
                "<td><button type=\"button\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#"+"m"+PID +"\">Update</button<td>"+
                "<td><button type=\"button\" class=\"btn btn-danger\">Delete</button></td>"+
            "</tr>"+
            
            /*each model habe ID = m+PID by default*/
            "<div class=\"modal fade\" id=\""+"m"+PID+"\" tabindex=\"-1\" role=\"dialog\"  aria-hidden=\"true\">"+
                "<div class=\"modal-dialog\" role=\"document\">"+
                    "<div class=\"modal-content\">"+
                        "<div class=\"modal-header\">"+
                            "<h5 class=\"modal-title\" id=\"exampleModalLabel\">"+PName+"</h5>"+
                            "<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">"+
                            "<span aria-hidden=\"true\">&times;</span>"+       
                            "</button>"+
                            "</div>"+
                            "<div class=\"modal-body\">"+
                            "<form>"+
                                "<input type=\"number\" class=\"form-control my-3\" placeholder=\"Enter new Price\" name=\"Price\">"+
                                "<input type=\"date\" class=\"form-control my-3\" placeholder=\"Enter new date\" name=\"ReleaseDate\">"+
                                "<input type=\"text\" class=\"form-control my-3\" placeholder=\"Enter new Publisher\" name=\"Publisher\">"+
                                "<input type=\"number\" class=\"form-control my-3\" placeholder=\"Enter new Quantity\" name=\"Quantity\">"+
                                "<input type=\"button\" class=\"btn btn-primary my-3\" onclick=update(\""+"m"+PID+"\") value=\"submit\">"+          
                            "</form>"+
                        "</div>" +   
                    "</div>"+
                "</div>"+
            "</div>";
            
            
            

            }
            //document.getElementById("productControl").innerHTML = html;
        }

    }
    }
    
    function display(){
        let ajax = new XMLHttpRequest();
        let method = "GET";
        let url = "php/showAllProduct.php";//php code
        let async = true; 
        
        
        ajax.open(method, url, async);
        ajaxProcess(ajax);
        ajax.send();
    
    }
        
    function update(ID){
        let Price = document.getElementById(ID).getElementsByTagName("input")[0].value;
        let ReleaseDate = document.getElementById(ID).getElementsByTagName("input")[1].value;
        let Publisher = document.getElementById(ID).getElementsByTagName("input")[2].value;
        let Quantity = document.getElementById(ID).getElementsByTagName("input")[3].value;
        let PName = document.getElementById(ID).getElementsByTagName("h5")[0].innerHTML;
        
       
        //string contain 3 args will be passed to backend
        let args = "?"+"Price="+Price+"&ReleaseDate="+ReleaseDate+"&Publisher="+Publisher+"&Quantity="+Quantity;
        
        
        
        let ajax = new XMLHttpRequest();
        let method = "GET";
        let url = "php/update.php"+args;//php code
        let async = true; 
        
        ajax.open(method, url, async);
        ajax.onreadystatechange = function(){
            if(this.readyState == 4 && this.status == 200){
                var data = this.responseText;
                console.log(data);

            }
        
        }
        ajax.send();
    }

    </script>
    
</head>

<body>
    
    <div class="banner"></div>
    
    
    
    
    <nav class="navbar navbar-expand-sm bg-primary navbar-dark sticky-top">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="productcontrol.html">Product Control</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="order.html">Order</a>
        </li>
      </ul>
    </nav>
    
    <table class="table table-hover">
        <thead class="thead-dark">
            <tr>
                <th scope="col">PID</th>
                <th scope="col">Name</th>
                <th scope="col">Price</th>
                <th scope="col">Release Date</th>
                <th scope="col">Publisher</th>
                <th scope="col">Quantity</th>
                <th scope="col">Update</th>
                <th scope="col">Remove</th>
            </tr>
        </thead>
        <tbody id = "productControl">
            <script>display()</script>
        </tbody>
    </table>
    
    
    
    
    
    

    
<footer>
 	
</footer>
</body>
</html>